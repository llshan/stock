# ç»¼åˆè‚¡ç¥¨åˆ†æžç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è‚¡ç¥¨åˆ†æžå·¥å…·ï¼Œç»“åˆæŠ€æœ¯åˆ†æžå’Œè´¢åŠ¡åˆ†æžï¼Œæä¾›å…¨æ–¹ä½çš„æŠ•èµ„å†³ç­–æ”¯æŒã€‚

## ðŸš€ æ ¸å¿ƒåŠŸèƒ½

### ðŸ“ˆ æŠ€æœ¯åˆ†æžæ¨¡å—
1. **å®žæ—¶æ•°æ®èŽ·å–**ï¼šèŽ·å–è‚¡ç¥¨çš„å®žæ—¶ä»·æ ¼å’Œäº¤æ˜“ä¿¡æ¯
2. **åŽ†å²æ•°æ®åˆ†æž**ï¼šä¸‹è½½å’Œåˆ†æžåŽ†å²ä»·æ ¼æ•°æ®
3. **æŠ€æœ¯æŒ‡æ ‡è®¡ç®—**ï¼š
   - ç§»åŠ¨å¹³å‡çº¿ (MA5, MA10, MA20, MA50)
   - ç›¸å¯¹å¼ºå¼±æŒ‡æ•° (RSI)
   - å¸ƒæž—å¸¦ (Bollinger Bands)
4. **æŠ€æœ¯å›¾è¡¨ç”Ÿæˆ**ï¼š
   - Kçº¿å›¾ (èœ¡çƒ›å›¾)
   - RSIæŒ‡æ ‡å›¾
   - å¸ƒæž—å¸¦å›¾è¡¨

### ðŸ’¼ è´¢åŠ¡åˆ†æžæ¨¡å— (æ–°å¢ž)
1. **è´¢åŠ¡æ•°æ®èŽ·å–**ï¼šèŽ·å–è¿‡åŽ»5å¹´çš„è´¢åŠ¡æŠ¥è¡¨æ•°æ®
2. **è´¢åŠ¡æŒ‡æ ‡è®¡ç®—**ï¼š
   - ç›ˆåˆ©èƒ½åŠ›ï¼šå‡€åˆ©æ¶¦çŽ‡ã€ROEã€ROA
   - å¿å€ºèƒ½åŠ›ï¼šè´Ÿå€ºçŽ‡ã€æµåŠ¨æ¯”çŽ‡
   - ä¼°å€¼æŒ‡æ ‡ï¼šå¸‚ç›ˆçŽ‡(PE)ã€å¸‚å‡€çŽ‡(PB)
   - æˆé•¿æ€§ï¼šè¥æ”¶å¢žé•¿çŽ‡ã€åˆ©æ¶¦å¢žé•¿çŽ‡
3. **è´¢åŠ¡å¥åº·è¯„ä¼°**ï¼šç»¼åˆè¯„åˆ†å’Œç­‰çº§è¯„å®š
4. **è´¢åŠ¡å›¾è¡¨ç”Ÿæˆ**ï¼š
   - è¥æ”¶è¶‹åŠ¿å›¾
   - è´¢åŠ¡æŒ‡æ ‡å¯¹æ¯”å›¾
   - å¥åº·è¯„åˆ†ä»ªè¡¨ç›˜

### ðŸŽ¯ ç»¼åˆåˆ†æžç³»ç»Ÿ
1. **æŠ€æœ¯+è´¢åŠ¡åŒé‡åˆ†æž**ï¼šç»“åˆä»·æ ¼èµ°åŠ¿å’ŒåŸºæœ¬é¢
2. **æ™ºèƒ½è¯„çº§ç³»ç»Ÿ**ï¼šA-Fäº”çº§è¯„å®š
3. **æŠ•èµ„å»ºè®®ç”Ÿæˆ**ï¼šä¹°å…¥/æŒæœ‰/å–å‡ºå»ºè®®
4. **é£Žé™©æç¤º**ï¼šè¯†åˆ«æ½œåœ¨æŠ•èµ„é£Žé™©
5. **ç»¼åˆæŠ¥å‘Š**ï¼šç”Ÿæˆä¸“ä¸šæŠ•èµ„åˆ†æžæŠ¥å‘Š

### ðŸ’¾ åŽ†å²æ•°æ®ç®¡ç†ç³»ç»Ÿ (æ–°å¢ž)
1. **å®Œæ•´æ•°æ®ä¸‹è½½**ï¼šä»Ž2020å¹´å¼€å§‹çš„æ‰€æœ‰ä»·æ ¼å’Œè´¢åŠ¡æ•°æ®
2. **ç»“æž„åŒ–å­˜å‚¨**ï¼šSQLite/PostgreSQLæ•°æ®åº“å­˜å‚¨
3. **æ•°æ®è´¨é‡ç›‘æŽ§**ï¼šè‡ªåŠ¨è¯„ä¼°æ•°æ®å®Œæ•´æ€§å’Œè´¨é‡
4. **æ‰¹é‡ç®¡ç†**ï¼šæ”¯æŒå¤šè‚¡ç¥¨æ‰¹é‡ä¸‹è½½å’Œæ›´æ–°
5. **GCPäº‘ç«¯éƒ¨ç½²**ï¼šæ”¯æŒCloud SQLæ•°æ®åº“

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ðŸŽ® ä½¿ç”¨æ–¹æ³•

### ðŸ”¥ æŽ¨èï¼šç»¼åˆåˆ†æžç³»ç»Ÿ

**åŸºæœ¬ä½¿ç”¨:**
```bash
python analyzer/comprehensive_analyzer.py
```

**è‡ªå®šä¹‰åˆ†æž:**
```python
from analyzer import ComprehensiveStockAnalyzer

analyzer = ComprehensiveStockAnalyzer()
symbols = ["AAPL", "GOOGL", "MSFT", "TSLA"]
results = analyzer.run_comprehensive_analysis(symbols, period="1y")
```

### ðŸ“Š å•ç‹¬æŠ€æœ¯åˆ†æž

```bash
python analyzer/stock_analyzer.py
```

### ðŸ’¼ å•ç‹¬è´¢åŠ¡åˆ†æž

```python
from analyzer import FinancialAnalyzer, FinancialDataFetcher

fetcher = FinancialDataFetcher()
analyzer = FinancialAnalyzer(fetcher)

# è´¢åŠ¡æ¯”çŽ‡åˆ†æž
ratios = analyzer.calculate_financial_ratios("AAPL")
print(f"å‡€åˆ©æ¶¦çŽ‡: {ratios['ratios']['net_profit_margin']:.2f}%")

# è´¢åŠ¡å¥åº·è¯„ä¼°
health = analyzer.analyze_financial_health("AAPL")
print(f"è´¢åŠ¡å¥åº·ç­‰çº§: {health['grade']}")
```

### âš ï¸ ä»·æ ¼ä¸‹è·Œç›‘æŽ§

ä»·æ ¼ä¸‹è·Œç›‘æŽ§åŠŸèƒ½å·²é›†æˆåœ¨æŠ€æœ¯åˆ†æžå’Œç»¼åˆåˆ†æžä¸­ï¼š

```python
from analyzer import StockAnalyzer, StockDataFetcher

# åˆ›å»ºåˆ†æžå™¨
fetcher = StockDataFetcher()
analyzer = StockAnalyzer(fetcher)

# å•ä¸ªè‚¡ç¥¨ä¸‹è·Œæ£€æµ‹
result = analyzer.check_price_drop('AAPL', days=1, threshold_percent=15.0)
if result['is_drop_alert']:
    print(f"è­¦å‘Š: {result['alert_message']}")

# æ‰¹é‡è‚¡ç¥¨ä¸‹è·Œæ£€æµ‹
symbols = ['AAPL', 'GOOGL', 'MSFT']
results = analyzer.batch_check_price_drops(symbols, days=1, threshold_percent=15.0)
print(f"å‘çŽ° {results['summary']['alerts_count']} åªè‚¡ç¥¨è§¦å‘è­¦å‘Š")
```

### ðŸ’¾ åŽ†å²æ•°æ®ç®¡ç†

**ä¸‹è½½å®Œæ•´åŽ†å²æ•°æ®:**
```bash
# ä¸‹è½½é¢„è®¾è§‚å¯Ÿæ¸…å•çš„æ‰€æœ‰æ•°æ®ï¼ˆä»Ž2020å¹´å¼€å§‹ï¼‰
python data_manager.py --use-watchlist --action download

# ä¸‹è½½ç‰¹å®šè‚¡ç¥¨çš„æ•°æ®
python data_manager.py --symbols AAPL GOOGL MSFT --action download

# æ›´æ–°å·²æœ‰è‚¡ç¥¨çš„æ•°æ®
python data_manager.py --symbols AAPL --action update
```

**æ•°æ®è´¨é‡æŠ¥å‘Š:**
```bash
# ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š
python data_manager.py --action report

# å¤‡ä»½æ•°æ®åº“
python data_manager.py --action backup --backup-path backup.db
```

**ç¼–ç¨‹æ–¹å¼ä½¿ç”¨:**
```python
from data_service.yfinance_downloader import YFinanceDataDownloader
from data_service.database import StockDatabase

# åˆ›å»ºä¸‹è½½å™¨å’Œæ•°æ®åº“
downloader = YFinanceDataDownloader()
database = StockDatabase("my_stock_data.db")

# ä¸‹è½½å¹¶å­˜å‚¨æ•°æ®
symbols = ['AAPL', 'GOOGL', 'MSFT']
for symbol in symbols:
    data = downloader.download_comprehensive_data(symbol, start_date="2020-01-01")
    if 'error' not in data:
        database.store_comprehensive_data(symbol, data)

# æŸ¥è¯¢åŽ†å²æ•°æ®
price_data = database.get_stock_prices('AAPL', '2023-01-01', '2023-12-31')
financial_data = database.get_financial_data('AAPL', 'income_statement')
```

### ðŸŽ¯ é«˜çº§è‡ªå®šä¹‰

```python
from analyzer import ComprehensiveStockAnalyzer

# åˆ›å»ºåˆ†æžå™¨
analyzer = ComprehensiveStockAnalyzer()

# è‡ªå®šä¹‰è‚¡ç¥¨åˆ—è¡¨å’Œåˆ†æžå‘¨æœŸ
symbols = ["AAPL", "AMZN", "NFLX", "META", "NVDA"]
results = analyzer.run_comprehensive_analysis(symbols, period="2y")

# æŸ¥çœ‹åˆ†æžç»“æžœ
for symbol, data in results.items():
    report = data['comprehensive_report']
    print(f"{symbol}: {report['overall_rating']} - {report['investment_recommendation']}")
    
    # è®¿é—®è¯¦ç»†æŠ€æœ¯åˆ†æžæ•°æ®
    tech = data['technical_analysis']
    if 'error' not in tech:
        print(f"  RSI: {tech['rsi']:.2f}, è¶‹åŠ¿: {tech['trend']}")
    
    # è®¿é—®è¯¦ç»†è´¢åŠ¡åˆ†æžæ•°æ®
    fin = data['financial_analysis']
    if 'error' not in fin:
        ratios = fin['ratios']
        print(f"  å‡€åˆ©æ¶¦çŽ‡: {ratios.get('net_profit_margin', 0):.2f}%")
```

## ðŸ“ è¾“å‡ºæ–‡ä»¶

ç¨‹åºä¼šåœ¨ `results/` æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### ðŸŽ¯ ç»¼åˆåˆ†æžè¾“å‡º
**æŠ€æœ¯åˆ†æžå›¾è¡¨:**
- `{è‚¡ç¥¨ä»£ç }_candlestick.html`: äº¤äº’å¼Kçº¿å›¾
- `{è‚¡ç¥¨ä»£ç }_rsi.png`: RSIæŒ‡æ ‡å›¾  
- `{è‚¡ç¥¨ä»£ç }_bollinger.html`: å¸ƒæž—å¸¦å›¾è¡¨

**è´¢åŠ¡åˆ†æžå›¾è¡¨:**
- `{è‚¡ç¥¨ä»£ç }_revenue_trend.html`: è¥æ”¶è¶‹åŠ¿å›¾
- `{è‚¡ç¥¨ä»£ç }_financial_metrics.png`: è´¢åŠ¡æŒ‡æ ‡åˆ†æžå›¾
- `{è‚¡ç¥¨ä»£ç }_health_dashboard.html`: è´¢åŠ¡å¥åº·ä»ªè¡¨ç›˜

### ðŸ“Š å•ç‹¬æŠ€æœ¯åˆ†æžè¾“å‡º
- `{è‚¡ç¥¨ä»£ç }_candlestick.html`: Kçº¿å›¾
- `{è‚¡ç¥¨ä»£ç }_rsi.png`: RSIæŒ‡æ ‡å›¾
- `{è‚¡ç¥¨ä»£ç }_bollinger.html`: å¸ƒæž—å¸¦å›¾è¡¨

## ðŸ“– æŒ‡æ ‡è¯´æ˜Ž

### ðŸ“ˆ æŠ€æœ¯æŒ‡æ ‡
- **ç§»åŠ¨å¹³å‡çº¿ (MA)**: MA5, MA20, MA50 ç”¨äºŽåˆ¤æ–­è¶‹åŠ¿æ–¹å‘
- **RSI (ç›¸å¯¹å¼ºå¼±æŒ‡æ•°)**: 0-100åŒºé—´ï¼Œ>70è¶…ä¹°ï¼Œ<30è¶…å–
- **å¸ƒæž—å¸¦**: ä¸Šä¸­ä¸‹è½¨åæ˜ ä»·æ ¼æ³¢åŠ¨æ€§å’Œæ”¯æ’‘é˜»åŠ›ä½

### ðŸ’¼ è´¢åŠ¡æŒ‡æ ‡ (æ–°å¢ž)
- **ç›ˆåˆ©èƒ½åŠ›**: å‡€åˆ©æ¶¦çŽ‡ã€ROE(å‡€èµ„äº§æ”¶ç›ŠçŽ‡)ã€ROA(èµ„äº§æ”¶ç›ŠçŽ‡)
- **å¿å€ºèƒ½åŠ›**: è´Ÿå€ºçŽ‡ã€æµåŠ¨æ¯”çŽ‡
- **ä¼°å€¼æŒ‡æ ‡**: å¸‚ç›ˆçŽ‡(PE)ã€å¸‚å‡€çŽ‡(PB)
- **æˆé•¿æ€§**: è¥æ”¶å’Œåˆ©æ¶¦å¢žé•¿çŽ‡

### ðŸŽ¯ ç»¼åˆè¯„çº§ç³»ç»Ÿ (æ–°å¢ž)
- **Açº§ (80-100åˆ†)**: å¼ºçƒˆæŽ¨è - ä¹°å…¥
- **Bçº§ (60-79åˆ†)**: æŽ¨è - ä¹°å…¥/æŒæœ‰
- **Cçº§ (40-59åˆ†)**: ä¸­æ€§ - æŒæœ‰
- **Dçº§ (20-39åˆ†)**: ä¸æŽ¨è - å‡æŒ
- **Fçº§ (0-19åˆ†)**: å¼ºçƒˆä¸æŽ¨è - å–å‡º

## ðŸ“‚ é¡¹ç›®ç»“æž„

```
Stock/
â”œâ”€â”€ ðŸ“Š analyzer/                 # æ ¸å¿ƒåˆ†æžæ¨¡å—åŒ…
â”‚   â”œâ”€â”€ __init__.py                     # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ stock_analyzer.py               # ðŸ“ˆ æŠ€æœ¯åˆ†æžæ¨¡å— (å«ä»·æ ¼ä¸‹è·Œç›‘æŽ§)
â”‚   â”œâ”€â”€ financial_analyzer.py           # ðŸ’¼ è´¢åŠ¡åˆ†æžæ¨¡å—
â”‚   â”œâ”€â”€ comprehensive_analyzer.py       # ðŸ”¥ ç»¼åˆåˆ†æžç³»ç»Ÿ
â”‚   â”œâ”€â”€ data_downloader.py              # ðŸ’¾ åŽ†å²æ•°æ®ä¸‹è½½å™¨
â”‚   â”œâ”€â”€ database.py                     # ðŸ—„ï¸ æ•°æ®åº“å­˜å‚¨æ¨¡å—
â”‚   â””â”€â”€ README.md                       # æ¨¡å—è¯´æ˜Žæ–‡æ¡£
â”œâ”€â”€ ðŸŒ¥ï¸ cloud/                   # GCP éƒ¨ç½²æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ deploy.sh                       # ðŸš€ è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ monitor.sh                      # ðŸ“Š ç³»ç»Ÿç›‘æŽ§è„šæœ¬
â”‚   â”œâ”€â”€ test_local.py                   # ðŸ§ª æœ¬åœ°æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ cloudbuild.yaml                 # â˜ï¸ Cloud Build é…ç½®
â”‚   â”œâ”€â”€ database_setup.py               # ðŸ—„ï¸ GCPæ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ GCP_DEPLOYMENT_GUIDE.md         # ðŸ“– GCP éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ README.md                       # Cloud ç›®å½•è¯´æ˜Ž
â”œâ”€â”€ main.py                      # ðŸŒ¥ï¸ GCP Cloud Function å…¥å£ç‚¹
â”œâ”€â”€ data_manager.py              # ðŸ“Š æ•°æ®ç®¡ç†å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ data_downloader_function.py # ðŸ’¾ ç‹¬ç«‹æ•°æ®ä¸‹è½½Cloud Function
â”œâ”€â”€ requirements.txt            # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜Žæ–‡æ¡£ (æœ¬æ–‡ä»¶)
â””â”€â”€ results/                    # ðŸ“ åˆ†æžç»“æžœè¾“å‡ºæ–‡ä»¶å¤¹
    â”œâ”€â”€ {è‚¡ç¥¨}_candlestick.html          # Kçº¿å›¾
    â”œâ”€â”€ {è‚¡ç¥¨}_financial_metrics.png     # è´¢åŠ¡æŒ‡æ ‡å›¾
    â”œâ”€â”€ {è‚¡ç¥¨}_health_dashboard.html     # å¥åº·ä»ªè¡¨ç›˜
    â””â”€â”€ ... (å…¶ä»–å›¾è¡¨æ–‡ä»¶)
```

**ðŸ’¡ ä¸ºä»€ä¹ˆ `main.py` åœ¨æ ¹ç›®å½•ï¼Ÿ**
- `main.py` æ˜¯ GCP Cloud Function çš„å…¥å£ç‚¹ï¼Œéœ€è¦èƒ½å¤Ÿå¯¼å…¥ `analyzer` åŒ…
- GCP éƒ¨ç½²æ—¶ä¼šåŒ…å«æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ï¼Œç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½å¯ç”¨
- è¿™æ ·çš„ç»“æž„ä½¿å¾—æœ¬åœ°å¼€å‘å’Œäº‘ç«¯éƒ¨ç½²éƒ½èƒ½æ­£å¸¸å·¥ä½œ

## ðŸ”§ æ•…éšœæŽ’é™¤

### ç½‘ç»œé—®é¢˜
å¦‚æžœé‡åˆ°ç½‘ç»œè¿žæŽ¥é—®é¢˜æˆ– Yahoo Finance API é™åˆ¶ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸
2. å°è¯•æ›´æ¢ç½‘ç»œçŽ¯å¢ƒ
3. ç¨‹åºä¼šè‡ªåŠ¨é‡è¯•å¹¶ç»™å‡ºé”™è¯¯æç¤º

### å¸¸è§é—®é¢˜
1. **ä¸­æ–‡å­—ä½“è­¦å‘Š**: å±žæ­£å¸¸çŽ°è±¡ï¼Œä¸å½±å“åŠŸèƒ½
2. **æ•°æ®èŽ·å–å¤±è´¥**: æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œç½‘ç»œæ˜¯å¦æ­£å¸¸
3. **å›¾è¡¨æ— æ³•æ˜¾ç¤º**: ç¡®ä¿æµè§ˆå™¨æ”¯æŒHTML5
4. **è´¢åŠ¡æ•°æ®ç¼ºå¤±**: æŸäº›è‚¡ç¥¨å¯èƒ½æ²¡æœ‰å®Œæ•´çš„è´¢åŠ¡æ•°æ®

## âš ï¸ é‡è¦å£°æ˜Ž

1. **æ•°æ®æ¥æº**: æ•°æ®æ¥è‡ª Yahoo Financeï¼Œå¯èƒ½æœ‰å»¶è¿Ÿæˆ–ä¸å®Œæ•´
2. **æŠ•èµ„å»ºè®®**: æœ¬ç¨‹åºæä¾›çš„åˆ†æžä»…ä¾›å‚è€ƒï¼Œä¸æž„æˆæŠ•èµ„å»ºè®®
3. **é£Žé™©æç¤º**: è‚¡å¸‚æœ‰é£Žé™©ï¼ŒæŠ•èµ„éœ€è°¨æ…Ž
4. **æ•°æ®å‡†ç¡®æ€§**: è¯·ä»¥å®˜æ–¹è´¢æŠ¥å’Œå®žæ—¶è¡Œæƒ…ä¸ºå‡†

## ðŸŽ“ å­¦ä¹ ä»·å€¼

æœ¬é¡¹ç›®å±•ç¤ºäº†ä»¥ä¸‹æŠ€æœ¯æ ˆå’Œæ¦‚å¿µï¼š
- **æ•°æ®ç§‘å­¦**: pandas, numpy æ•°æ®å¤„ç†
- **å¯è§†åŒ–**: matplotlib, plotly å›¾è¡¨ç”Ÿæˆ
- **é‡‘èžåˆ†æž**: æŠ€æœ¯æŒ‡æ ‡å’Œè´¢åŠ¡æ¯”çŽ‡è®¡ç®—
- **APIé›†æˆ**: yfinance æ•°æ®èŽ·å–
- **è½¯ä»¶å·¥ç¨‹**: æ¨¡å—åŒ–è®¾è®¡ã€é”™è¯¯å¤„ç†ã€æ–‡æ¡£ç¼–å†™
